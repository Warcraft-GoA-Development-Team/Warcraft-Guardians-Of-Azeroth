#Patch 1.9.0
#Skinning Festival
#by fivesanon

namespace = WCGW

#Liege sends letters and prepares
character_event = {
	id = WCGW.100
	desc = WCGWDESC.100
	is_triggered_only = yes
	picture = GFX_evt_campfire_hf
	border = GFX_event_letter_frame_diplomacy

	option={
		name = EVTOPTA_WCGW.100
		wealth = -25
		set_character_flag = holding_skinning_festival
		set_character_flag = recent_minor_decision
		set_character_flag = do_not_disturb
		any_vassal = {
			limit={
				prisoner=no
				age=16
				culture_group=gnoll_group
				war = no
				NOT = { trait = incapable }
				liege = { character = ROOT }
			}
			character_event = { id = WCGW.102 tooltip = EVTTOOLTIP_WCGW_102 days = 2 }
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 8 }
					}
				}
			}
		}
		hidden_tooltip = { character_event = { id = WCGW.101 days = 10 } }
		hidden_tooltip = { character_event = { id = WCGW.699 days = 150 } } # Safety catch flag clearing
	}
	option = {
		name = EVTOPTB_WCGW.100
		tooltip = stops_the_event_chain
		clr_character_flag = holding_skinning_festival
		clr_character_flag = recent_minor_decision
		clr_character_flag = do_not_disturb
	}
}
#Liege skinning begins
character_event = {
	id = WCGW.101
	desc = WCGWDESC.101
	is_triggered_only = yes
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_diplomacy

	option = {
		name = EVTOPTA_WCGW.101
		if = {
			limit = {
				any_courtier={
					prisoner = yes
					host = { character = ROOT }
					can_be_sacrificed_trigger = yes
				}
			}
			character_event = { id = WCGW.103 days = 1 }
		}
	}
}
#Vassal gets letter
character_event = {
	id = WCGW.102
	desc = WCGWDESC.102
	is_triggered_only = yes
	picture = GFX_evt_campfire_hf
	border = GFX_event_letter_frame_diplomacy

	option = {
		name = EVTOPTA_WCGW.102
		set_character_flag = attending_skinning_festival
		set_character_flag = do_not_disturb
	}
	option = {
		name=EVTOPTB_WCGW.102
		add_character_modifier = { name = declined_skinning_festival months = 18 }
	}
}
#selected to be skinned by captor
character_event = {
	id = WCGW.103
	desc = WCGWDESC.103
	is_triggered_only = yes
	picture = GFX_evt_campfire_hf
	border = GFX_event_letter_frame_diplomacy

	option = {
		name = EVTOPTA_WCGW.103
		if = {
			limit = {
				NOT = {
					sibling = FROM
					father = { character = FROM }
					mother = { character = FROM }
					any_spouse = { character = FROM }
					any_child = { character = FROM }
					any_dynasty_member = { character = FROM}
					prestige = 1000
					ruler = yes
				}
				random_list = {
					25 = { FROM = { character_event = { id = WCGW.104 } } } #skinned evt1
					25 = { FROM = { character_event = { id = WCGW.999 } } } #skinned evt2
					25 = { FROM = { character_event = { id = WCGW.999 } } } #skinned evt3
					10 = { FROM = { character_event = { id = WCGW.999 } } } #escaped evt1
					5 = { FROM = { character_event = { id = WCGW.999 } } } #escaped evt2
				}
			}
		}
	}
}
#skinned evt1
character_event={
	id = WCGW.104
	desc = WCGWDESC.104
	is_triggered_only = yes
	picture = GFX_evt_campfire_hf
	border = GFX_event_letter_frame_diplomacy

	option = {
		name = EVTOPTA_WCGW.104
		FROM = {
			death = {
				death_reason = death_skinned
				killer = ROOT
			}
		}
		any_vassal = {
			limit = {
				has_character_flag = attending_skinning_festival
				is_playable = yes
			}
			character_event = { id = WCGW.999 }
		}
	}
	option = {
		name = EVTOPTB_WCGW.104
		FROM = { character_event = { id = WCGW.999 tooltip = EVTTOOLTIP_TOG_637 } }
		prestige = -25
	}
}